/*
  Copyright Jesús Pérez <jesusprubio@fsf.org>

  This code may only be used under the MIT license found at
  https://opensource.org/licenses/MIT.
*/

'use strict';

const defaults = {
  query: 'Apache 7.4',
  only: false,
  timeout: 10000,
};


exports.yargs = {
  command: 'exploitsearch',
  describe: 'Find vulnerabilities and exploit for an specific' +
            ' service version (using exploitsearch.net API).',

  builder: {
    query: {
      type: 'string',
      alias: 'q',
      describe: `Query to search for [${defaults.query}]`,
    },
    only: {
      type: 'boolean',
      alias: 'o',
      describe: `Only exploits [${defaults.only}]`,
    },
    timeout: {
      type: 'number',
      alias: 't',
      describe: `Request timeout [${defaults.timeout}]`,
    },
  },

  handler: (argv = {}) => {
    /* eslint-disable global-require */
    const search = require('exploitsearch');
    const logger = require('pown-logger');
    /* eslint-enable global-require */


    logger.title(this.yargs.command);

    search(argv.query || defaults.query, {
      timeout: argv.only || defaults.timeout,
      exploits: argv.only || defaults.only,
    })
    .then((res) => {
      logger.result();
      logger.chunks(res, 1);
    });
  },
};
